<script th:fragment="js" th:inline="javascript" type="text/javascript">
    $(document).ready(function () {
        console.log("DOCUMENT WILL BE RAEDY TO EBTALK");

        // 이벤트 핸들러 초기화
        init_events();

    })

    /*
     * init_events() START
     */
    function init_events() {
        console.log("init_events() CALLED!!");


        let study_no = $(".study-room-box").parent().attr('no');
        console.log("m_category_no");
        // 리스트 조회
        ajax_show_memoir_list(study_no);

        // 등록
        $(document).on("click", "#well_btn", function (e) {
            console.log("#well_btn CLICK HANDLER!!")

            let m_category_no = $(this).data("m_category_no");
            console.log("m_category_no: " + m_category_no);

            ajax_register_memoir(study_no, m_category_no);

        });
        // 등록 확인
        $(document).on("click", "#register_btn", function (e) {
            console.log("#register_btn CLICK HANDLER!!");

            ajax_register_confirm_memoir(study_no, m_category_no);

        });

    }

    /*
     * ajax_show_memoir_list() START
     */
    function ajax_show_memoir_list(study_no) {
        console.log("show_memoir_list() CALLED!!");

        $.ajax({
            url: `/studyroom/memoir_list?study_no=${study_no}`,
            method: 'GET',
            processData: false,
            contentType: false,
            success: function (data) {
                console.log('ajax_alert_approval');
                console.log(data);

                let studyRoomDtos = data.studyRoomDtos;

                for (let i = 0; i < data.length; i++) {
                    if(studyRoomDtos[i].m_category_no === 1) {
                        let appendTag = '<div class="study-room-doc-1">';
                        appendTag += '<div class="name"><span class="doc-span doc-font" >' + studyRoomDtos[i].name + '</span></div>';
                        appendTag += '<div class="date">';
                        appendTag += '<p class="doc-font">' + studyRoomDtos[i].created_at + '</p>';
                        appendTag += '</div>';
                        appendTag += '</div>';

                        appendTag += '<div class="study-room-doc-2">';
                        appendTag += '<p>' + studyRoomDtos[i].content + '</p>'
                        appendTag += '</div>';

                        appendTag += '<div class="study-room-doc-3">';
                        appendTag += '<div class="study-room-doc-btn">';
                        appendTag += '<span class="doc-span"><a class="doc-font" th:href="@{/studyroom/study_modify_confirm(no=${' + studyRoomDtos[i].no + '})}">수정</a></span>';
                        appendTag += '<span class="doc-span"><a class="doc-font" th:href="@{/studyroom/study_delete_confirm(no=${' + studyRoomDtos[i].no + '})}">삭제</a></span>';
                        appendTag += '</div>';
                        appendTag += '</div>';

                        $("#went_well").append(appendTag);

                    } else if(studyRoomDtos[i].m_category_no === 2) {

                        let appendTag = '<div class="study-room-doc-1">';
                        appendTag += '<div class="name"><span class="doc-span doc-font">이은지</span></div>';
                        appendTag += '<div class="date">';
                        appendTag += '<p class="doc-font">2024-05-15</p>';
                        appendTag += '</div>';
                        appendTag += '</div>';

                        appendTag += '<div class="study-room-doc-2">';
                        appendTag += '<p>프로젝트관리~~~~~</p>'
                        appendTag += '</div>';

                        appendTag += '<div class="study-room-doc-3">';
                        appendTag += '<div class="study-room-doc-btn">';
                        appendTag += '<span class="doc-span"><a class="doc-font" href="#">수정</a></span>';
                        appendTag += '<span class="doc-span"><a class="doc-font" href="#">삭제</a></span>';
                        appendTag += '</div>';
                        appendTag += '</div>';

                        $("#went_well").append(appendTag);

                    } else {
                        let appendTag = '<div class="study-room-doc-1">';
                        appendTag += '<div class="name"><span class="doc-span doc-font">이은지</span></div>';
                        appendTag += '<div class="date">';
                        appendTag += '<p class="doc-font">2024-05-15</p>';
                        appendTag += '</div>';
                        appendTag += '</div>';

                        appendTag += '<div class="study-room-doc-2">';
                        appendTag += '<p>프로젝트관리~~~~~</p>'
                        appendTag += '</div>';

                        appendTag += '<div class="study-room-doc-3">';
                        appendTag += '<div class="study-room-doc-btn">';
                        appendTag += '<span class="doc-span"><a class="doc-font" href="#">수정</a></span>';
                        appendTag += '<span class="doc-span"><a class="doc-font" href="#">삭제</a></span>';
                        appendTag += '</div>';
                        appendTag += '</div>';

                        $("#to_improve").append(appendTag);
                    }
                }
            },
            error: function () {
                console.log('AJAX ERROR - ajax_alert_approval()');
                alert('문제가 발생했습니다. 다시 시도해주세요.');
            }
        });

    }
    /*
     * ajax_show_memoir_list() END
     */

    function remove_regist_memoir() {
        console.log("remove_regist_memoir()");

        // $(".remove-regist-memoir-form").remove();
        $(document).on("click", "#cancel_btn", function (e) {
            console.log("#cancel_btn CLICK HANDLER!!");

            location.reload();

        });
    }

    /*
     * ajax_register_memoir() START
     */
    function ajax_register_memoir(study_no, m_category_no) {
        console.log("ajax_register_memoir()");

        // let appendTag = '<div class="study-room-document" id="went_well">';

        // let className = $(this).data("m_category_no");

        let appendTag = '<div class="study-room-document" id="went_well">';
        appendTag += '<div class="study-room-doc-2 remove-regist-memoir-form">';
        appendTag += '<textarea name="content"></textarea>';
        appendTag += '</div>';

        appendTag += '<div class="study-room-doc-3 remove-regist-memoir-form">';
        appendTag += '<div class="study-room-doc-btn">';
        appendTag += '<input class="check-btn btn font" id="register_btn" type="submit" value="확인"/>';
        appendTag += '<input class="check-btn btn font" id="cancel_btn" type="button" onclick="remove_regist_memoir();" value="취소"/>';
        appendTag += '</div>';
        appendTag += '</div>';
        appendTag += '</div>';

        $(".study-room-container").append(appendTag);

        $("#plus_btn").hide();
        $("#well_btn").hide();

        $("#went_well").css(
            {
                 "width": "220px", "height": "280px",
                "border": "1px solid #fff", "background": "#fff",
                "border-radius": "10px"
            }
        );
    }
    /*
    * ajax_register_memoir() END
     */

    /*
     * ajax_register_memoir() START
     */
    function ajax_register_confirm_memoir() {
        $.ajax({
            url: `/studyroom/study_register_confirm?study_no=${study_no}&&m_category_no=${m_category_no}`,
            method: 'GET',
            processData: false,
            contentType: false,
            success: function (data) {
                console.log('ajax_alert_approval');
                console.log(data);

                ajax_show_memoir_list(study_no);

            },
            error: function () {
                console.log('AJAX ERROR - ajax_alert_approval()');
                alert('문제가 발생했습니다. 다시 시도해주세요.');
            }
        });

    }
    /*
     * ajax_register_memoir() END
     */

</script>